/* To Do:
-fix column widths for tables | APPROXIMATELY DONE


*/

var fullMetalData = {
	cols: [
		"username",
		"fullname",
		"region",
		"race",
		"wins",
		"losses"
	],
	data: [
		[
			"ridiculus",
			"Acton Williamson",
			"Europe",
			"Zerg",
			40,
			234
		],
		[
			"purus",
			"Felix Bennett",
			"Europe",
			"Zerg",
			152,
			380
		],
		[
			"interdum",
			"Stacy Ferrell",
			"Korea",
			"Zerg",
			22,
			136
		],
		[
			"Mauris",
			"Olivia Higgins",
			"Europe",
			"Terran",
			279,
			374
		],
		[
			"odio",
			"Addison Scott",
			"Europe",
			"Zerg",
			62,
			249
		],
		[
			"scelerisque",
			"Olivia Ruiz",
			"America",
			"Terran",
			283,
			24
		],
		[
			"varius",
			"Ulla Boyer",
			"Korea",
			"Protoss",
			362,
			437
		],
		[
			"nisi",
			"Giacomo Holden",
			"Korea",
			"Zerg",
			41,
			461
		],
		[
			"tempus",
			"Palmer Barton",
			"Korea",
			"Terran",
			489,
			249
		],
		[
			"Cras",
			"Quamar Benson",
			"Korea",
			"Protoss",
			451,
			27
		],
		[
			"Aliquam",
			"Ali Robbins",
			"Europe",
			"Zerg",
			445,
			306
		],
		[
			"non",
			"Alan Osborne",
			"Korea",
			"Terran",
			36,
			455
		],
		[
			"neque",
			"Martena Sykes",
			"Europe",
			"Zerg",
			94,
			426
		],
		[
			"Phasellus",
			"Lana Reed",
			"Europe",
			"Protoss",
			423,
			186
		],
		[
			"mauris",
			"Gil Dyer",
			"Korea",
			"Zerg",
			87,
			290
		],
		[
			"mi",
			"Basil Moses",
			"America",
			"Zerg",
			486,
			95
		],
		[
			"nisl",
			"Cullen Hale",
			"Korea",
			"Terran",
			372,
			359
		],
		[
			"sit",
			"Roary Martin",
			"Korea",
			"Protoss",
			406,
			111
		],
		[
			"ullamcorper",
			"Faith Hart",
			"Korea",
			"Terran",
			45,
			135
		],
		[
			"arcu",
			"Sacha Dodson",
			"Europe",
			"Terran",
			228,
			463
		],
		[
			"erat",
			"Jada Noel",
			"Europe",
			"Zerg",
			196,
			243
		],
		[
			"vulputate",
			"Rinah Foley",
			"Europe",
			"Terran",
			391,
			428
		],
		[
			"Fusce",
			"Noble Washington",
			"Europe",
			"Terran",
			174,
			492
		],
		[
			"malesuada",
			"Brynn Hopkins",
			"America",
			"Terran",
			162,
			66
		],
		[
			"enim",
			"Garth Larsen",
			"Europe",
			"Zerg",
			219,
			417
		],
		[
			"felis",
			"Zelda Mendez",
			"Europe",
			"Protoss",
			168,
			131
		],
		[
			"neque",
			"Tad Mcmillan",
			"Europe",
			"Protoss",
			426,
			307
		],
		[
		"turpis",
		"Jemima Walsh",
		"America",
		"Protoss",
		81,
		280
		],
		[
		"ggoDeye",
		"Ryan Dagg",
		"Europe",
		"Zerg",
		449,
		8
		],
		[
		"turpis",
		"Christopher Gonzalez",
		"Europe",
		"Protoss",
		165,
		72
		],
		[
		"metus",
		"Samson Yates",
		"Europe",
		"Zerg",
		373,
		21
		],
		[
		"facilisis",
		"Regan Cooper",
		"Korea",
		"Protoss",
		190,
		396
		],
		[
		"luctus",
		"Claudia Orr",
		"Korea",
		"Terran",
		386,
		81
		],
		[
		"nulla",
		"Remedios Keller",
		"America",
		"Zerg",
		470,
		271
		],
		[
		"lobortis",
		"Derek Fischer",
		"America",
		"Zerg",
		11,
		126
		],
		[
		"et",
		"Chaney Mitchell",
		"Europe",
		"Protoss",
		246,
		97
		],
		[
		"nec",
		"Abraham Whitney",
		"America",
		"Terran",
		325,
		162
		],
		[
		"felis",
		"Kennedy Ellis",
		"America",
		"Zerg",
		148,
		193
		],
		[
		"ut",
		"Tarik Hendrix",
		"America",
		"Terran",
		192,
		459
		],
		[
		"mi",
		"Nolan Hensley",
		"Europe",
		"Terran",
		158,
		87
		],
		[
		"egestas",
		"Charity Schmidt",
		"Korea",
		"Zerg",
		54,
		129
		],
		[
		"blandit",
		"Briar Macias",
		"Korea",
		"Terran",
		291,
		96
		],
		[
		"mollis",
		"Lael Mayo",
		"Korea",
		"Zerg",
		202,
		113
		],
		[
		"consectetuer",
		"Hasad Lloyd",
		"Korea",
		"Terran",
		100,
		51
		],
		[
		"sodales",
		"Keith Craft",
		"Europe",
		"Protoss",
		319,
		281
		],
		[
		"justo",
		"Elmo Carlson",
		"America",
		"Protoss",
		349,
		51
		],
		[
		"ornare",
		"Donovan Kline",
		"Korea",
		"Protoss",
		211,
		12
		],
		[
		"turpis",
		"Hiroko Daugherty",
		"Europe",
		"Protoss",
		178,
		74
		],
		[
		"a",
		"Karen Rodriguez",
		"Europe",
		"Zerg",
		458,
		307
		],
		[
		"Sed",
		"Ella French",
		"Europe",
		"Terran",
		424,
		423
		],
		[
		"pharetra",
		"Duncan England",
		"Korea",
		"Terran",
		346,
		214
		],
		[
		"Nam",
		"Camilla Rocha",
		"America",
		"Zerg",
		156,
		209
		],
		[
		"primis",
		"Rosalyn George",
		"Europe",
		"Terran",
		174,
		292
		],
		[
		"rhoncus",
		"Cassidy Holden",
		"Europe",
		"Protoss",
		313,
		73
		],
		[
		"pede",
		"Leo Shaw",
		"Europe",
		"Protoss",
		85,
		472
		],
		[
		"ligula",
		"Rowan Duke",
		"America",
		"Protoss",
		443,
		51
		],
		[
		"Quisque",
		"Kermit Howard",
		"America",
		"Terran",
		433,
		253
		],
		[
		"iaculis",
		"Cooper Callahan",
		"Korea",
		"Terran",
		353,
		15
		],
		[
		"massa",
		"Wallace Cook",
		"Europe",
		"Zerg",
		219,
		280
		],
		[
		"a",
		"Oliver House",
		"America",
		"Protoss",
		69,
		385
		],
		[
		"orci",
		"Armand Mooney",
		"America",
		"Terran",
		244,
		55
		],
		[
		"sed",
		"Blair Santana",
		"America",
		"Terran",
		137,
		123
		],
		[
		"Etiam",
		"Azalia Odonnell",
		"Europe",
		"Terran",
		473,
		24
		],
		[
		"eget",
		"Hamilton Coffey",
		"Europe",
		"Protoss",
		490,
		477
		],
		[
		"Nunc",
		"Mia Hopper",
		"Korea",
		"Terran",
		262,
		135
		],
		[
		"lobortis",
		"Carol Lott",
		"America",
		"Terran",
		18,
		298
		],
		[
		"interdum",
		"Nerea Lopez",
		"Korea",
		"Protoss",
		385,
		173
		],
		[
		"facilisis",
		"Samuel Gardner",
		"America",
		"Terran",
		386,
		40
		],
		[
		"erat",
		"Lynn Mclaughlin",
		"Europe",
		"Protoss",
		34,
		294
		],
		[
		"fringilla",
		"Lilah Meyers",
		"America",
		"Zerg",
		262,
		336
		],
		[
		"Duis",
		"Nehru Horne",
		"Korea",
		"Zerg",
		247,
		11
		],
		[
		"ultricies",
		"Faith Rosario",
		"America",
		"Zerg",
		160,
		314
		],
		[
		"consectetuer",
		"Julie Pace",
		"Europe",
		"Protoss",
		359,
		417
		],
		[
		"ridiculus",
		"Mercedes Graves",
		"Europe",
		"Zerg",
		374,
		86
		],
		[
		"tortor",
		"Eliana Nguyen",
		"America",
		"Terran",
		221,
		330
		],
		[
		"mauris",
		"Melanie Witt",
		"America",
		"Zerg",
		114,
		398
		],
		[
		"dolor",
		"Illiana Lancaster",
		"America",
		"Zerg",
		73,
		358
		],
		[
		"aliquam",
		"Rashad Irwin",
		"Europe",
		"Terran",
		318,
		290
		],
		[
		"pharetra",
		"Griffin Atkinson",
		"America",
		"Protoss",
		137,
		168
		],
		[
		"Suspendisse",
		"Paki Marks",
		"Korea",
		"Protoss",
		46,
		468
		],
		[
		"adipiscing",
		"Amelia Bolton",
		"Korea",
		"Terran",
		115,
		283
		],
		[
		"placerat",
		"Aubrey Cooper",
		"America",
		"Terran",
		191,
		37
		],
		[
		"sem",
		"Sharon Goff",
		"Europe",
		"Zerg",
		274,
		292
		],
		[
		"eget",
		"Robin Norris",
		"Europe",
		"Terran",
		209,
		385
		],
		[
		"arcu",
		"Amery Abbott",
		"Korea",
		"Protoss",
		198,
		486
		],
		[
		"ligula",
		"Harding Gould",
		"Korea",
		"Protoss",
		30,
		3
		],
		[
		"tempus",
		"Maggie Macias",
		"Korea",
		"Terran",
		337,
		310
		],
		[
		"molestie",
		"Daryl Barlow",
		"Europe",
		"Protoss",
		343,
		258
		],
		[
		"enim",
		"Tana Tyler",
		"Europe",
		"Protoss",
		253,
		173
		],
		[
		"Cras",
		"Nell Hebert",
		"America",
		"Protoss",
		416,
		107
		],
		[
		"nisi",
		"Guinevere Swanson",
		"Europe",
		"Protoss",
		324,
		408
		],
		[
		"justo",
		"Mikayla Kirk",
		"America",
		"Terran",
		424,
		28
		],
		[
		"purus",
		"Drew Marks",
		"America",
		"Zerg",
		275,
		117
		],
		[
		"mi",
		"Pascale Bernard",
		"Korea",
		"Terran",
		237,
		29
		],
		[
		"eu",
		"Myra Parsons",
		"America",
		"Zerg",
		399,
		77
		],
		[
		"nulla",
		"Katelyn Acevedo",
		"America",
		"Protoss",
		449,
		95
		],
		[
		"vel",
		"Melyssa Price",
		"Korea",
		"Terran",
		239,
		391
		],
		[
		"diam",
		"Hanna Duke",
		"Europe",
		"Protoss",
		134,
		464
		],
		[
		"ultrices",
		"Madeson Pickett",
		"Europe",
		"Zerg",
		90,
		392
		],
		[
		"commodo",
		"Kibo Oliver",
		"Korea",
		"Terran",
		18,
		407
		]
	]	
}

// declare a variable for the main data section of fullMetalData
data = fullMetalData.data;

// define variables to be used in table generation
var tableStart = 0;
var tableEnd = 19;

var createTable = function(start, stop) {
	// create table header
	$(".data-table table").empty();
	$(".data-table table").append(
		"<tr>" +
			"<th>result</th>" +
 			"<th class = 'header-button'>" + fullMetalData.cols[0] + "</th>" +
 			"<th class = 'header-button'>" + fullMetalData.cols[1] + "</th>" +
			"<th class = 'header-button'>" + fullMetalData.cols[2] + "</th>" +
			"<th class = 'header-button'>" + fullMetalData.cols[3] + "</th>" +
			"<th class = 'header-button'>" + fullMetalData.cols[4] + "</th>" +
			"<th class = 'header-button'>" + fullMetalData.cols[5] + "</th>" +
		"</tr>" 
		)

	// create table rows
 	for (var i = start; i <= stop; i++) {
 		$(".data-table table").append(
 			"<tr>" +
 				"<td>" + (i + 1) + "</td>" +
	 			"<td>" + data[i][0] + "</td>" +
	 			"<td>" + data[i][1] + "</td>" +
				"<td>" + data[i][2] + "</td>" +
				"<td>" + data[i][3] + "</td>" +
				"<td>" + data[i][4] + "</td>" +
				"<td>" + data[i][5] + "</td>" +
			"</tr>" 
		)	
 	}
 }

// function to sort main data by column
var sortByColumn = function(index, reverse) {
	if (reverse) {
		// console.log("if working")
		data = _.sortBy(data, function(item) {return item[index]});
		data.reverse();
	}
	else {
		data = _.sortBy(data, function(item) {return item[index]});
	}	
}

// create a variable to be used by columnTracker function. Keeps track of ascending versus descending initial sort method. Ultimately used by sortByColumn function to determin if reversing should occur.
var columnsValue = {username: true, fullname: true , region: true , race: true, wins: true , losses: false};

// used to flip values in columnsValue for use by sortByColumn to determine if column should display ascending or descending.
var columnTracker = function(column) {
	if(columnsValue[column]) {
		console.log("current test: ", columnsValue[column])
		columnsValue[column] = false;
	}
	else {
		columnsValue[column] = true;
	}
	return columnsValue[column]

}


var totalGames = function() {
 	var total = 0;
 	_.each(data, function(element) {
 		total += element[4];
 	})
 	return total;
}

var totalGamesLosses = function() {
 	var total = 0;
 	_.each(data, function(element) {
 		total += element[5];
 	})
 	return total;
}

var totalPlayers = data.length;

var racePopularity = function(race) {
 	var total = 0;
 	_.each(data, function(element) {
 		if(element[3] === race) {
 			total++ ;
 		}
 	})
 	return (total / data.length * 100) + "%";
}

// manage name of specific nav buttons
var nameButtons = function(dataSample) {
	if (typeof(dataSample) === "string") {
		return dataSample[0] + dataSample[1];
	}
	else {
		return dataSample;
	}
}

// create dynamic buttons for scrolling based on sort method
var createNavButtons = function(index) {
	$(".specific-button").empty();
	for (var i = 0; i < data.length - 19; i += 20) {
		$(".specific-button").append(
			"<button>" + String(nameButtons(data[i][index])) + " - " + String(nameButtons(data[i + 19][index])) + "</button>");
	}
}



// docuement on ready
$(document).on('ready', function() {
	// input stats into stats-table
	$(".total-games").text(totalGames());
	$(".total-players").text(totalPlayers);
	$(".zerg-percent").text(racePopularity("Zerg"));
	$(".terran-percent").text(racePopularity("Terran"));
	$(".protoss-percent").text(racePopularity("Protoss"));

	// create table on load
	sortByColumn(4, true);
	createTable(tableStart, tableEnd)
	createNavButtons(4);

	/*nav button handlers*/
	// next button
	$(document).on('click', '.next-button', function() {
		if(data.length >= tableEnd + 20) {
			tableStart += 20
			tableEnd += 20
			createTable(tableStart, tableEnd);

		}
	})

	// previous button
	$(document).on('click', '.previous-button', function() {
		if(tableStart - 20 >= 0) {
			tableStart -= 20
			tableEnd -= 20
			createTable(tableStart, tableEnd);
		}
	})

	// last button
	$(document).on('click', '.last-button', function() {
		tableStart = data.length - 20
		tableEnd = data.length - 1
		createTable(tableStart, tableEnd);
	})

	// first button
	$(document).on('click', '.first-button', function() {
		tableStart = 0
		tableEnd = 19
		createTable(tableStart, tableEnd);
	})

	// sort by column
	$(document).on('click', ".header-button", function() {
		var columnNumber = fullMetalData.cols.indexOf($(this).text())
		var columnName = $(this).text()

		console.log("columnName: " + columnName)
		sortByColumn(columnNumber, columnTracker(columnName));
		tableStart = 0;
		tableEnd = 19;
		createTable(tableStart, tableEnd);
		createNavButtons(columnNumber);

	})

	// specific nav button handling
	$(document).on("click", ".specific-button button", function() {
		var indexMultiple = $(".specific-button button").index(this);
		tableStart = 0 + indexMultiple * 20;
		tableEnd = 19  + indexMultiple * 20;
		createTable(tableStart, tableEnd);
	})
});